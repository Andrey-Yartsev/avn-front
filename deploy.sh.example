#!/bin/bash

if [ -z "$1" ]
then
  BRANCH="develop"
else
  BRANCH=$1
fi

cd /home/ubuntu/team3/deploy
git fetch origin
git checkout $BRANCH
git pull origin $BRANCH
cp /home/ubuntu/team3/.env /home/ubuntu/team3/deploy/.env
npm i
npm run build
git log -1 --pretty="%h %B %ad" > ./dist/version.txt
echo " $BRANCH" >> ./dist/version.txt
cat ./dist/version.txt

rm -r /var/www/html/team3.retloko.com/public_html
mv /home/ubuntu/team3/deploy/dist /var/www/html/team3.retloko.com/public_html